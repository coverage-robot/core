WITH
  availability AS (
    SELECT
      commit,
      tag,
      ARRAY_AGG(
        STRING(ingestTime)
      ) as ingestTimes
    FROM
      `mock-table`
    WHERE
      repository = "mock-repository"
      AND owner = "mock-owner"
      AND provider = "github"
    GROUP BY
      commit,
      tag
  )
SELECT
  availability.tag as tagName,
  ARRAY_AGG(
    STRUCT(
      commit as commit, tag as name, ingestTimes as ingestTimes
    )
  ) as carryforwardTags,
FROM
  availability
GROUP BY
  availability.tag